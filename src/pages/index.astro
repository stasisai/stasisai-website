---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import KineticGrid from '../components/KineticGrid.jsx';
---

<Layout title="MAFIS by Stasis AI — MAPF Fault Injection Simulator">

  <Header />

  <!-- SNAP SCROLL CONTAINER -->
  <div class="snap-container">

    <!-- ══════════ HERO ══════════ -->
    <section class="hero-section">
      <div class="hero-canvas-wrapper">
        <KineticGrid client:only="react" />
      </div>

      <!-- Readability gradient -->
      <div class="hero-gradient"></div>

      <!-- Hero content -->
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="hero-title">
            Inject faults.<br/>
            <em>Analyze chaos.</em>
          </h1>
          <p class="hero-subtitle">
            A blazing fast MAPF fault injection simulator, powered by MAFIS.
            Built in Rust, compiled to WebAssembly.
          </p>
          <div class="hero-cta">
            <a href="/simulator" class="btn-primary">Run Simulation</a>
            <a href="/docs" class="btn-docs">View Docs</a>
          </div>
        </div>
      </div>

      <div class="scroll-hint">
        <p>scroll</p>
        <div class="scroll-line"></div>
      </div>
    </section>

    <!-- ══════════ TECH NARRATIVE (DARK) ══════════ -->
    <section class="dark-section">
      <div class="section-inner">
        <h2 class="dark-title">
          Written in Rust.<br/>
          <em>Compiled to WebAssembly.</em>
        </h2>

        <!-- Pillar Group for Hover Fading -->
        <div class="pillar-group">
          <!-- Pillar 1: Blazing Fast -->
          <div class="pillar-row">
            <div class="pillar-icon-box">
              <span class="pillar-mod">MOD.01</span>
              <img src="/stasis-blazing-fast.svg" alt="Blazing Fast" class="pillar-icon" />
            </div>
            <div class="pillar-content">
              <h3 class="pillar-title" style="color:#E8862A;">
                <span class="pillar-line" style="background:#E8862A;"></span>Blazing Fast
              </h3>
              <p class="pillar-text">
                Powered by <a href="https://bevyengine.org/" target="_blank" class="bevy-link"><strong>Bevy Engine</strong></a> and Rust's zero-cost abstractions. No garbage collector pauses. No runtime overhead. No compromises.
              </p>
            </div>
          </div>

          <!-- Pillar 2: Research-Grade -->
          <div class="pillar-row">
            <div class="pillar-icon-box">
              <span class="pillar-mod">MOD.02</span>
              <img src="/stasis-research.svg" alt="Research Grade" class="pillar-icon" />
            </div>
            <div class="pillar-content">
              <h3 class="pillar-title" style="color:#3DB8E8;">
                <span class="pillar-line" style="background:#3DB8E8;"></span>Research-Grade
              </h3>
              <p class="pillar-text">
                Built on state-of-the-art MAPF solvers — <strong>CBS, LaCAM, PIBT</strong>. Every algorithm implemented from peer-reviewed publications and validated against published benchmarks.
              </p>
            </div>
          </div>

          <!-- Pillar 3: Fault Injection -->
          <div class="pillar-row">
            <div class="pillar-icon-box">
              <span class="pillar-mod">MOD.03</span>
              <img src="/stasis-fault.svg" alt="Fault Injection" class="pillar-icon" />
            </div>
            <div class="pillar-content">
              <h3 class="pillar-title" style="color:#34D399;">
                <span class="pillar-line" style="background:#34D399;"></span>Fault Injection
              </h3>
              <p class="pillar-text">
                Inject crash faults at any scale. Observe <strong>cascading failures</strong> propagate in real time across hundreds of concurrent agents. Measure recovery latency with precision.
              </p>
            </div>
          </div>
        </div>

        <div class="stats-grid" id="performance-stats">
          <div class="stat">
            <span class="stat-value stat-red">[<span class="counter" data-target="256" data-start="0">0</span>]</span>
            <span class="stat-label">Concurrent Agents</span>
            <div class="stat-bar"><div class="stat-fill" data-color="var(--red)" data-width="80%" style="width: 0%; background: var(--red);"></div></div>
          </div>
          <div class="stat">
            <span class="stat-value stat-green">[<span class="counter" data-target="60" data-start="0">0</span> FPS]</span>
            <span class="stat-label">Fluid Rendering</span>
            <div class="stat-bar"><div class="stat-fill" data-color="var(--green)" data-width="100%" style="width: 0%; background: var(--green);"></div></div>
          </div>
          <div class="stat">
            <span class="stat-value">[<span class="counter" data-target="0" data-start="120">120</span>ms]</span>
            <span class="stat-label">Latency Overhead</span>
            <div class="stat-bar"><div class="stat-fill" data-color="rgba(240,237,233,0.5)" data-width="5%" style="width: 100%; background: rgba(240,237,233,0.5);"></div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ══════════ FEATURES ══════════ -->
    <section class="features-section">
      <div class="section-inner">
        <h3 class="features-title">Deep <em>Inspection</em></h3>
        <div class="cards-grid">
          <!-- CARD 1 -->
          <div class="card card-hover-red">
            <div class="card-bg-number">01</div>
            <div class="card-header">
              <div class="card-tag">Inspection . 01</div>
              <div class="micro-viz-timeline">
                <div class="m-dot m-dot-green"></div><div class="m-line"></div>
                <div class="m-dot m-dot-red pulse"></div><div class="m-line m-line-broken"></div>
              </div>
            </div>
            <h4 class="card-title">Crash Faults</h4>
            <p class="card-text">Simulate sudden hard failures. Observe instantaneous rerouting latency across dense networks and cascading delays as the swarm recovers.</p>
          </div>
          <!-- CARD 2 -->
          <div class="card card-hover-orange">
            <div class="card-bg-number">02</div>
            <div class="card-header">
              <div class="card-tag">Inspection . 02</div>
              <div class="micro-viz-heatmap">
                <div class="m-square m-c1"></div><div class="m-square m-c2"></div>
                <div class="m-square m-c3"></div><div class="m-square m-c4"></div>
              </div>
            </div>
            <h4 class="card-title">Congestion Heatmaps</h4>
            <p class="card-text">Visualize invisible bottlenecks cascading through paths. Track heat persistence and pressure distribution via spatial grids in real time.</p>
          </div>
          <!-- CARD 3 -->
          <div class="card card-hover-blue">
            <div class="card-bg-number">03</div>
            <div class="card-header">
              <div class="card-tag">Inspection . 03</div>
              <div class="micro-viz-matrix">
                <span>1</span><span>0</span><span>0</span><span>1</span>
                <span>0</span><span style="color:#3DB8E8">1</span><span>0</span><span>0</span>
              </div>
            </div>
            <h4 class="card-title">Deterministic Replay</h4>
            <p class="card-text">Record and replay chaotic cascade events step-by-step. Perfect determinism ensures rare crash anomalies can be isolated and studied offline.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ══════════ ECOSYSTEM & COMMUNITY ══════════ -->
    <section class="community-section">
      <div class="section-inner">
        <h3 class="community-title">The MAPF <em>Ecosystem</em></h3>
        <p class="community-intro">
          MAFIS (Multi-Agent Fault Injection Simulator) focuses entirely on the intersection of pathfinding and chaos engineering. We believe in modular logic and collaboration over duplication.
        </p>
        
        <div class="ecosystem-grid">
          <div class="eco-card">
            <h4 class="eco-title">Algorithm Benchmarking</h4>
            <p class="eco-text">
              We do not track algorithm baseline performances. For state-of-the-art algorithmic comparisons and the definitive leaderboard of solvers, we proudly refer researchers to the community-maintained <strong>MAPF Tracker</strong>.
            </p>
            <a href="https://tracker.pathfinding.ai/" target="_blank" class="eco-link">Visit MAPF Tracker ↗</a>
          </div>
          
          <div class="eco-card">
            <h4 class="eco-title">Standard Instances</h4>
            <p class="eco-text">
              We do not host rigid instance sets. For standardized 2D grid test environments (cities, games, mazes) and standard scenarios, please consult the <strong>MovingAI MAPF Benchmarks</strong> suite.
            </p>
            <a href="https://movingai.com/benchmarks/mapf.html" target="_blank" class="eco-link">View MovingAI Benchmarks ↗</a>
          </div>

          <div class="eco-card">
            <h4 class="eco-title">Real-World Testbed</h4>
            <p class="eco-text">
              We specialize in abstract chaos mechanics. To bridge the gap between MAPF logic and real-world robotics scaling, we highly recommend the <strong>SMART MAPF</strong> scalable realistic testbed.
            </p>
            <a href="https://smart-mapf.github.io/demo/" target="_blank" class="eco-link">Explore SMART MAPF ↗</a>
          </div>
        </div>
      </div>
    </section>

    <!-- ══════════ FOOTER ══════════ -->
    <footer class="site-footer">
      <div class="footer-inner">
        <span class="footer-copy">&copy; 2026 Stasis AI</span>
        <div class="footer-links">
          <a href="/about">Story</a>
          <a href="https://github.com/stasisai" target="_blank">GitHub</a>
        </div>
      </div>
    </footer>

  </div>

  <!-- BACK TO TOP BUTTON -->
  <button id="back-to-top" class="back-to-top" aria-label="Back to top">
    ↑ SCROLL TO TOP
  </button>

  <script is:inline>
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    // Astro inline script guaranteed to run in client
    document.addEventListener("DOMContentLoaded", () => {
      const container = document.querySelector('.snap-container');
      const header = document.getElementById('main-header');
      const backToTop = document.getElementById('back-to-top');

      if (!container || !header || !backToTop) return;

      container.addEventListener('scroll', () => {
        // Hide header and show back to top when scrolling down past 300px
        if (container.scrollTop > 300) {
          header.classList.add('header-hidden');
          backToTop.classList.add('visible');
        } else {
          header.classList.remove('header-hidden');
          backToTop.classList.remove('visible');
        }
      });

      backToTop.addEventListener('click', () => {
        // Temporarily disable scroll snapping to allow smooth scroll to top
        container.style.scrollSnapType = 'none';
        container.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Re-enable snapping after scrolling finishes
        setTimeout(() => {
          container.style.scrollSnapType = 'y mandatory';
        }, 800);
      });

      // Stats Animation logic
      const statsSection = document.getElementById('performance-stats');
      if (statsSection) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              // Trigger animations
              statsSection.classList.add('animated');
              
              // Animate Numbers
              const counters = statsSection.querySelectorAll('.counter');
              counters.forEach(counter => {
                const target = parseInt(counter.getAttribute('data-target'));
                const start = parseInt(counter.getAttribute('data-start'));
                const duration = 1500; // ms
                const startTime = performance.now();
                
                const updateCounter = (currentTime) => {
                  const elapsed = currentTime - startTime;
                  const progress = Math.min(elapsed / duration, 1);
                  // Ease out quad
                  const easeProgress = progress * (2 - progress);
                  const currentStr = Math.floor(start + (target - start) * easeProgress);
                  counter.innerText = currentStr;
                  if (progress < 1) {
                    requestAnimationFrame(updateCounter);
                  } else {
                    counter.innerText = target;
                  }
                };
                requestAnimationFrame(updateCounter);
              });
              
              // Animate Bars
              const fills = statsSection.querySelectorAll('.stat-fill');
              fills.forEach(fill => {
                const targetWidth = fill.getAttribute('data-width');
                fill.style.width = targetWidth; // Transitions handled by CSS
              });
              
              observer.unobserve(statsSection);
            }
          });
        }, { threshold: 0.5 });
        
        observer.observe(statsSection);
      }
    });
  </script>

  <style>
    /* ─── Snap Container ───────────────────────────────────── */
    .snap-container {
      height: 100vh; /* Fallback */
      height: 100dvh; /* Dynamic viewport height for mobile bars */
      width: 100%;
      overflow-y: scroll;
      overflow-x: hidden;
      scroll-snap-type: y mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }

    /* ─── Header ───────────────────────────────────────────── */
    /* These styles are now assumed to be part of the Header component's styling */
    /* .site-header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 200;
      padding: 16px 32px;
      display: flex; align-items: center; justify-content: space-between;
      background: rgba(245,242,238,0.9);
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(0,0,0,0.06);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
    }
    
    .site-header.header-hidden {
      transform: translateY(-100%);
      opacity: 0;
      pointer-events: none;
    }

    .header-brand {
      display: flex; align-items: center; gap: 10px; text-decoration: none;
    }
    .header-logo { height: 28px; width: auto; }
    .header-name {
      font-family: var(--mono); font-weight: 500;
      letter-spacing: 0.08em; color: var(--dark);
      font-size: 14px; text-transform: uppercase;
    }
    .header-nav { 
      display: flex; gap: 24px; align-items: center;
    }

    .nav-link {
      font-family: var(--mono); text-transform: uppercase;
      font-size: 12px; letter-spacing: 0.08em;
      color: var(--text); text-decoration: none;
      transition: opacity 0.2s;
    }
    .nav-link:hover { opacity: 0.6; } */

    /* ─── Mobile Menu ──────────────────────────────────────── */
    /* These styles are now assumed to be part of the Header component's styling */
    /* .burger-btn {
      display: none; flex-direction: column; justify-content: space-between;
      width: 28px; height: 18px; background: transparent; border: none;
      cursor: pointer; z-index: 200; padding: 0;
    }
    .burger-btn span {
      width: 100%; height: 2px; background: var(--dark); transition: all 0.3s ease;
    }
    .burger-btn.open span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
    .burger-btn.open span:nth-child(2) { opacity: 0; }
    .burger-btn.open span:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }

    .mobile-menu {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(135deg, rgba(245,242,238,0.98), rgba(240,237,233,0.98));
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      z-index: 150; display: flex; flex-direction: column; justify-content: center;
      padding: 40px; opacity: 0; pointer-events: none;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      transform: translateY(-20px);
    }
    .mobile-menu.open { opacity: 1; pointer-events: auto; transform: translateY(0); }
    .mobile-menu-inner { display: flex; flex-direction: column; gap: 32px; align-items: flex-start; }
    .mobile-link { font-family: var(--serif); font-size: clamp(3rem, 10vw, 4rem); color: var(--dark); text-decoration: none; line-height: 1; letter-spacing: -1px; transition: opacity 0.2s; }
    .mobile-link:hover { opacity: 0.6; } */

    /* ─── Hero Section ─────────────────────────────────────── */
    .hero-section {
      position: relative; width: 100%; 
      height: 100vh; height: 100dvh;
      overflow: hidden; background: var(--bg);
      scroll-snap-align: start;
    }
    .hero-gradient {
      position: absolute; top: 0; left: 0; bottom: 0; width: 55%; z-index: 10;
      background: linear-gradient(to right, rgba(245,242,238,0.95) 60%, rgba(245,242,238,0) 100%);
      pointer-events: none;
    }
    .hero-content {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 15;
      display: flex; flex-direction: column; justify-content: center;
      padding: 0 48px; pointer-events: none;
    }
    .hero-text { max-width: 620px; pointer-events: auto; }
    .hero-title {
      font-family: var(--serif);
      font-size: clamp(2.5rem, 6vw, 5rem);
      color: var(--text); margin-bottom: 24px;
      line-height: 1.05; letter-spacing: -1.5px;
    }
    .hero-title em { color: rgba(10,10,10,0.35); font-style: italic; }
    .hero-subtitle {
      font-family: var(--sans); font-weight: 400;
      font-size: clamp(0.95rem, 1.5vw, 1.1rem);
      color: var(--text); opacity: 0.7;
      max-width: 440px; margin-bottom: 36px; line-height: 1.8;
    }
    .hero-cta { display: flex; gap: 12px; flex-wrap: wrap; }

    /* Buttons */
    .btn-primary {
      display: inline-block; background: var(--dark); color: var(--text-dark);
      font-family: var(--mono); font-size: 14px; text-transform: uppercase;
      border-radius: 0; padding: 14px 28px; cursor: pointer; text-decoration: none;
      transition: opacity 0.2s; letter-spacing: 0.05em;
    }
    .btn-primary:hover { opacity: 0.85; }
    .btn-docs {
      display: inline-block; background: var(--surface);
      border: 2px solid var(--dark); color: var(--dark);
      font-family: var(--mono); font-size: 14px; text-transform: uppercase;
      border-radius: 0; padding: 12px 28px; cursor: pointer; text-decoration: none;
      transition: background 0.2s; letter-spacing: 0.05em;
    }
    .btn-docs:hover { background: #E8E4DF; }

    /* Scroll hint */
    .scroll-hint {
      position: absolute; bottom: 28px; left: 50%;
      transform: translateX(-50%); z-index: 20;
      opacity: 0.25; text-align: center;
    }
    .scroll-hint p {
      font-family: var(--mono); font-size: 10px;
      text-transform: uppercase; letter-spacing: 0.2em; color: var(--text);
    }
    .scroll-line {
      width: 1px; height: 18px; background: var(--text);
      margin: 6px auto 0; animation: scrollPulse 2s infinite;
    }

    /* ─── Dark Section ─────────────────────────────────────── */
    .dark-section {
      position: relative; z-index: 20; background: var(--dark);
      width: 100%; min-height: 100vh; color: var(--text-dark);
      display: flex; align-items: center; scroll-snap-align: start;
    }
    .section-inner {
      max-width: 1100px; margin: 0 auto; padding: 64px 32px; width: 100%;
    }
    .dark-title {
      font-family: var(--serif);
      font-size: clamp(2rem, 4.5vw, 4rem);
      color: var(--text-dark); letter-spacing: -1px;
      line-height: 1.1; margin-bottom: 48px;
    }
    .dark-title em { color: rgba(240,237,233,0.35); }

    .pillar-group:hover .pillar-row { opacity: 0.3; }
    .pillar-group .pillar-row:hover { opacity: 1; transform: translateX(8px); }
    
    .pillar-row {
      display: flex; align-items: flex-start; gap: 32px;
      padding: 32px 0;
      border-top: 1px solid rgba(240,237,233,0.1);
      flex-wrap: wrap;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .pillar-group .pillar-row:last-child {
      border-bottom: 1px solid rgba(240,237,233,0.1);
    }

    .pillar-icon-box { 
      position: relative; flex-shrink: 0;
    }
    .pillar-mod {
      position: absolute; top: -14px; left: 0;
      font-family: var(--mono); font-size: 8px; color: rgba(240,237,233,0.3);
      letter-spacing: 0.1em;
    }
    .pillar-icon { 
      height: 64px; width: 64px; border-radius: 16px; 
      background: var(--surface); padding: 4px;
      object-fit: cover;
    }
    .pillar-content { flex: 1; min-width: 240px; padding-top: 4px; }
    .pillar-title {
      font-family: var(--mono); font-size: 13px;
      text-transform: uppercase; letter-spacing: 0.12em;
      margin-bottom: 8px; font-weight: 500;
      display: flex; align-items: center; gap: 12px;
    }
    .pillar-line {
      display: inline-block; width: 24px; height: 1px;
      background: currentColor; opacity: 0.5;
    }
    .pillar-text {
      font-family: var(--sans); font-weight: 300; font-size: 0.95rem;
      color: rgba(240,237,233,0.55); max-width: 480px; line-height: 1.7;
    }
    
    .bevy-link {
      color: inherit;
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 3px;
      transition: opacity 0.2s;
    }
    .bevy-link:hover { opacity: 0.7; }

    .stats-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 32px;
      margin-top: 64px;
    }
    .stat { font-family: var(--mono); font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; }
    .stat-value {
      display: block; font-family: var(--serif);
      font-size: clamp(1.8rem, 3.5vw, 2.5rem);
      margin-bottom: 6px; font-weight: 400; letter-spacing: normal;
      color: var(--text-dark);
      line-height: 1.1;
    }
    .stat-label { color: rgba(240,237,233,0.45); display: inline-block; margin-bottom: 12px; font-size: 11px; }
    .stat-red { color: var(--red); text-shadow: 0 0 16px rgba(153, 27, 27, 0.4); }
    .stat-green { color: var(--green); text-shadow: 0 0 16px rgba(4, 120, 87, 0.4); }
    .stat-bar { 
      width: 100%; max-width: 140px; height: 2px; background: rgba(240,237,233,0.1); 
      border-radius: 1px; overflow: hidden; 
    }
    .stat-fill { 
      height: 100%; border-radius: 1px; 
      transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1);
    }

    /* ─── Features Section ─────────────────────────────────── */
    .features-section {
      position: relative; z-index: 20; background: var(--bg);
      width: 100%; min-height: 100vh; display: flex; align-items: center;
      scroll-snap-align: start;
    }
    .features-title {
      font-family: var(--serif);
      font-size: clamp(1.8rem, 3.5vw, 3rem);
      margin-bottom: 48px; letter-spacing: -0.5px;
    }
    .features-title em { font-style: italic; }

    .cards-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;
    }
    .card {
      position: relative; overflow: hidden;
      background: var(--surface); border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px; padding: 32px;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      cursor: default;
    }
    .card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.04); }
    
    .card-hover-red:hover { border-top: 2px solid var(--red); }
    .card-hover-orange:hover { border-top: 2px solid #E8862A; }
    .card-hover-blue:hover { border-top: 2px solid #3DB8E8; }

    .card-bg-number {
      position: absolute; right: -10px; bottom: -20px;
      font-family: var(--serif); font-size: 8rem; font-style: italic;
      color: var(--dark); opacity: 0.03; line-height: 1;
      pointer-events: none; user-select: none;
    }

    .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; }
    .card-tag {
      font-family: var(--mono); font-size: 10px;
      text-transform: uppercase; letter-spacing: 0.15em;
      color: var(--text-sec);
    }
    .card-title {
      font-family: var(--serif); font-size: 1.5rem; margin-bottom: 12px; position: relative; z-index: 2;
    }
    .card-text {
      font-family: var(--sans); font-weight: 300;
      color: var(--text-sec); line-height: 1.7; font-size: 0.9rem; position: relative; z-index: 2;
    }

    /* Micro Visualizations */
    .micro-viz-timeline { display: flex; align-items: center; gap: 4px; }
    .m-dot { width: 6px; height: 6px; border-radius: 50%; }
    .m-dot-green { background: var(--green); }
    .m-dot-red { background: var(--red); }
    .m-line { width: 12px; height: 1px; background: rgba(0,0,0,0.2); }
    .m-line-broken { background: repeating-linear-gradient(90deg, rgba(0,0,0,0.2), rgba(0,0,0,0.2) 2px, transparent 2px, transparent 4px); }
    @keyframes pulseViz { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.4; transform: scale(1.4); } 100% { opacity: 1; transform: scale(1); } }
    .pulse { animation: pulseViz 1.5s infinite; }

    .micro-viz-heatmap { display: grid; grid-template-columns: repeat(2, 1fr); gap: 2px; }
    .m-square { width: 8px; height: 8px; border-radius: 2px; }
    .m-c1 { background: #E8862A; opacity: 0.4; } .m-c2 { background: var(--red); opacity: 0.7; }
    .m-c3 { background: var(--green); opacity: 0.5; } .m-c4 { background: #E8862A; opacity: 0.9; }

    .micro-viz-matrix { 
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 2px 4px;
      font-family: var(--mono); font-size: 8px; color: rgba(0,0,0,0.3); line-height: 1;
    }

    /* ─── Community Section ────────────────────────────────── */
    .community-section {
      width: 100%; background: var(--dark); color: #F0EDE9; padding: 80px 0;
      position: relative; z-index: 20; scroll-snap-align: start;
    }
    .community-title {
      font-family: var(--serif); font-size: clamp(1.8rem, 3vw, 2.5rem);
      margin-bottom: 24px; letter-spacing: -0.5px;
    }
    .community-title em { font-style: italic; color: rgba(240,237,233,0.5); }
    .community-intro {
      font-family: var(--sans); font-weight: 300; font-size: 1rem;
      color: rgba(240,237,233,0.6); max-width: 640px; margin-bottom: 48px;
      line-height: 1.6;
    }
    
    .ecosystem-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 32px;
    }
    .eco-card {
      background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05);
      border-radius: 8px; padding: 32px;
      transition: border-color 0.3s, background 0.3s;
    }
    .eco-card:hover { border-color: rgba(255,255,255,0.15); background: rgba(255,255,255,0.04); }
    .eco-title {
      font-family: var(--mono); font-size: 11px; text-transform: uppercase;
      letter-spacing: 0.12em; color: rgba(240,237,233,0.9); margin-bottom: 12px;
    }
    .eco-text {
      font-family: var(--sans); font-weight: 300; font-size: 0.9rem;
      color: rgba(240,237,233,0.5); margin-bottom: 24px; line-height: 1.6;
    }
    .eco-text strong {
      font-weight: 500; color: rgba(240,237,233,0.8);
    }
    .eco-link {
      display: inline-block; font-family: var(--mono); font-size: 10px;
      text-transform: uppercase; letter-spacing: 0.1em; color: rgba(240,237,233,0.9);
      text-decoration: none; padding-bottom: 4px;
      border-bottom: 1px solid rgba(255,255,255,0.2); transition: opacity 0.2s;
    }
    .eco-link:hover { opacity: 0.6; }

    /* ─── Footer ───────────────────────────────────────────── */
    .site-footer {
      width: 100%; background: var(--bg); padding: 40px 32px;
      border-top: 1px solid rgba(0,0,0,0.08);
      position: relative; z-index: 20; scroll-snap-align: end;
    }
    .footer-inner {
      max-width: 1100px; margin: 0 auto;
      display: flex; justify-content: space-between; align-items: center;
    }
    .footer-copy, .footer-links a {
      font-family: var(--mono); font-size: 11px;
      text-transform: uppercase; letter-spacing: 0.12em;
      color: var(--text-sec); text-decoration: none;
    }
    .footer-links { display: flex; gap: 24px; }

    /* ─── Back to Top ──────────────────────────────────────── */
    .back-to-top {
      position: fixed;
      bottom: 40px;
      right: 40px;
      z-index: 90;
      background: transparent;
      border: none;
      font-family: var(--mono);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-sec);
      cursor: pointer;
      opacity: 0;
      pointer-events: none;
      transform: translateY(10px);
      transition: all 0.3s ease;
    }
    .back-to-top.visible {
      opacity: 0.5;
      pointer-events: auto;
      transform: translateY(0);
    }
    .back-to-top:hover {
      opacity: 1;
      color: var(--text);
    }

    /* ─── Responsive ───────────────────────────────────────── */
    @media (max-width: 900px) {
      .hero-gradient { width: 100%; background: rgba(245,242,238,0.85); }
      .hero-content { padding: 0 24px; }
      .cards-grid { grid-template-columns: 1fr; }
      .ecosystem-grid { grid-template-columns: 1fr; gap: 40px; }
      .stats-grid { grid-template-columns: 1fr; gap: 24px; margin-top: 40px; }
      .dark-section, .features-section, .community-section { min-height: auto; padding: 64px 0; }
      .section-inner { padding: 48px 24px; }
      
      .pillar-row { flex-direction: row; align-items: flex-start; gap: 16px; padding: 24px 0; flex-wrap: nowrap; }
      .pillar-icon { height: 48px; width: 48px; padding: 4px; border-radius: 12px; flex-shrink: 0; }
      .pillar-content { flex: 1; min-width: 0; }
      
      .header-nav { gap: 16px; }
      .back-to-top { bottom: 24px; right: 24px; }
    }

    @media (max-width: 600px) {
      .hero-canvas-wrapper { display: none; }
      .hero-content { padding: 0 20px; height: 100vh; height: 100dvh; display: flex; flex-direction: column; justify-content: center; }
      .hero-title { font-size: 3.5rem; margin-bottom: 20px; line-height: 1.05; }
      
      /* Make dark section single viewport */
      .dark-section { min-height: 100vh; min-height: 100dvh; display: flex; align-items: center; padding: 0; background-color: var(--dark); }
      
      /* Features section allowed to scroll to respect rich content height */
      .features-section { min-height: auto; padding: 64px 0; display: block; }
      .section-inner { padding: 32px 20px; width: 100%; }
      .dark-title { font-size: 2.2rem; margin-bottom: 24px; }
      .features-title { font-size: 2.2rem; margin-bottom: 32px; }
      
      .pillar-row { padding: 16px 0; flex-wrap: nowrap; gap: 16px; align-items: flex-start; }
      .pillar-icon-box { margin-top: 4px; }
      .pillar-mod { display: none; }
      .pillar-title { font-size: 11px; margin-bottom: 4px; }
      .pillar-line { width: 12px; }
      .pillar-text { font-size: 0.85rem; line-height: 1.5; }
      
      .pillar-group:hover .pillar-row { opacity: 1; transform: none; }
      .pillar-group .pillar-row:hover { transform: none; }
      
      .stats-grid { margin-top: 32px; gap: 16px; }
      .stat-value { font-size: 1.6rem; }
      .stat-label { font-size: 9px; margin-bottom: 6px; }
      .stat-bar { max-width: 100px; }
      
      .cards-grid { gap: 16px; }
      .card { padding: 24px; }
      .card-title { font-size: 1.3rem; margin-bottom: 8px; }
      .card-text { font-size: 0.85rem; line-height: 1.5; }
      .card-bg-number { font-size: 5rem; right: -5px; bottom: -10px; }
      
      .community-section { padding: 48px 0; border-top: none; }
      .community-title { font-size: 1.8rem; margin-bottom: 20px; }
      .community-intro { font-size: 0.9rem; margin-bottom: 32px; }
      
      .footer-inner { flex-direction: column; gap: 16px; text-align: center; }
    }

    @keyframes scrollPulse {
      0%, 100% { opacity: 0.3; transform: scaleY(1); }
      50% { opacity: 0.8; transform: scaleY(1.4); }
    }
  </style>
</Layout>
